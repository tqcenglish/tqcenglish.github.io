<!DOCTYPE html>
<html lang=zh-CN>
  <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <meta name="description" content="伐木掎矣，析薪杝矣">
  <meta name="keywords" content="">
  
    <link rel="icon" href="https://assets-cdn.github.com/favicon.ico">
  
    
  <title>羚羊挂角</title>
  <link rel="stylesheet" href="/style.css">
  <link rel="stylesheet" href="/lib/jquery.fancybox.min.css">
  <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
  <!-- Global Site Tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=GA_TRACKING_ID"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-47275396-1');
  </script>
</head>

<body>
  <header>
  <div class="header-container">
    <a class='logo' href="/">
      <span>羚羊挂角</span>
    </a>
    <ul class="right-header">
      
        <li class="nav-item">
          
            <a href="/" class="item-link">首页</a>
          
        </li>
      
        <li class="nav-item">
          
            <a href="/about" class="item-link">关于</a>
          
        </li>
      
        <li class="nav-item">
          
            <a href="/archives" class="item-link">归档</a>
          
        </li>
      
        <li class="nav-item">
          
            <a href="/tags" class="item-link">标签</a>
          
        </li>
      
    </ul>
  </div>
</header>

  <main id='post'>
  <div class="content">
    <article>
        <section class="content markdown-body">
          <h1>无标题</h1>
          <div class='post-meta'>
            <i class="fa fa-calendar" aria-hidden="true"></i> <time>2020年03月16日</time>
            
            
          </div>
          <h1 id="Coovox-2016-10-4"><a href="#Coovox-2016-10-4" class="headerlink" title="Coovox 2016/10/4"></a>Coovox 2016/10/4</h1><p>系统中的相关知识可能错误。 由于系统直接使用了 ubuntu 系统，所以一些地方有差别。 文档需要<strong>更新</strong>。<br>运行在 Linux 下基于 Asterisk 的 PBX。</p>
<h2 id="目录结构"><a href="#目录结构" class="headerlink" title="目录结构"></a>目录结构</h2><p>Coovox 运行在 Linux 系统上，所以目录结构与 Linux 相关。</p>
<h3 id="语音文件位置"><a href="#语音文件位置" class="headerlink" title="语音文件位置"></a>语音文件位置</h3><ul>
<li>语音文件位置 <strong>/var/lib/asterisk/sounds</strong></li>
<li>Moh是Music On Hold 缩写。 Moh文件目录地址 <strong>/var/lib/asterisk/moh</strong>，它链接到 <strong>/var/lib/asterisk/sounds/moh</strong>。</li>
</ul>
<h3 id="录音文件"><a href="#录音文件" class="headerlink" title="录音文件"></a>录音文件</h3><p>在 <strong>extensions_general.conf</strong> 中设置录音文件存放位置，默认目录 <strong>/var/spool/asterisk/monitor/</strong> 下有三个子目录分别对应三种录音方式</p>
<ul>
<li>recording   //通话录音</li>
<li>meetme      //会议录音</li>
<li>one_touch   //一键录音， 修改了features.c文件中： one_touch/通道/文件名</li>
</ul>
<p><strong>/www/monitor</strong> 链接到文件 <strong>/var/spool/asterisk/monitor</strong></p>
<h3 id="prompts"><a href="#prompts" class="headerlink" title="prompts"></a>prompts</h3><p><strong>/www/prompts</strong> 包含closed.gsm, welcome.gsm两个文件，对应非工作和工作两种状态。<br>它链接到文件目录<strong>/var/lib/asterisk/prompts</strong>。</p>
<h3 id="Music"><a href="#Music" class="headerlink" title="Music"></a>Music</h3><p>通过 Music management 上传后音乐文件在： <strong>/var/lib/asterisk/sounds/</strong>目录下</p>
<h3 id="Voicemail"><a href="#Voicemail" class="headerlink" title="Voicemail"></a>Voicemail</h3><p>由 <strong>extensions_general.conf</strong> 中设置 <strong>/var/spool/asterisk/voicemail/default</strong></p>
<h3 id="Fax"><a href="#Fax" class="headerlink" title="Fax"></a>Fax</h3><p><strong>/var/spool/asterisk/fax</strong></p>
<h3 id="Call-Log"><a href="#Call-Log" class="headerlink" title="Call Log"></a>Call Log</h3><ul>
<li>/var/log/asterisk/cdr-csv/所有通话日志的字段信息Master.csv。</li>
<li>/var/log/asterisk/cdr-custom/ 用户自定的log 的Master.csv</li>
</ul>
<h3 id="脚本程序"><a href="#脚本程序" class="headerlink" title="脚本程序"></a>脚本程序</h3><ul>
<li><p>/etc/scripts/</p>
<pre><code>bulk_users_gen(二进制)
logger.sh
runddns
dahdi_scan.sh  
logspackage.sh
runddns.sh
dahdi_update.sh  使用dahdi_cfg使得FXS/FXO通道生效 
  network.sh
service.sh
dhcpd_conf.sh
ntp
shell_scripts.sh
down_users_extensions（二进制）  
openvpnkey.sh
snmp.sh
emailtofax.sh
package.sh
vpnclient.sh
faxlog.sh
parse.sh
vpnserver.sh
faxtoemail.sh
phonesinit.sh（，auto_phone_zycoo二进制）
vpnusers.sh
</code></pre></li>
</ul>
<h3 id="IP"><a href="#IP" class="headerlink" title="IP"></a>IP</h3><p>用户的IP信息存放在 <strong>/etc/asterisk/rc.conf</strong></p>
<h3 id="cgi"><a href="#cgi" class="headerlink" title="cgi"></a>cgi</h3><ul>
<li>/www/cgi-bin<br>   upload 二进制程序</li>
</ul>
<h3 id="PPTP-VPN"><a href="#PPTP-VPN" class="headerlink" title="PPTP VPN"></a>PPTP VPN</h3><ul>
<li>/usr/sbin/pptp-client   （二进制） //完成pptp vpn客户拨号程序</li>
</ul>
<h3 id="证书位置"><a href="#证书位置" class="headerlink" title="证书位置"></a>证书位置</h3><h4 id="TLS的证书位置"><a href="#TLS的证书位置" class="headerlink" title="TLS的证书位置"></a>TLS的证书位置</h4><ul>
<li><p>/etc/asterisk/keys/</p>
<p>   asterisk.crt<br>   asterisk.key<br>   asterisk.pem<br>   ca.crt<br>   ca.key</p>
</li>
</ul>
<h4 id="openvpn-证书位置"><a href="#openvpn-证书位置" class="headerlink" title="openvpn 证书位置"></a>openvpn 证书位置</h4><ul>
<li><p>/etc/openvpn/keys/</p>
<p>   ca.crt<br>   ca.key<br>   dh1024.pem<br>   server.crt<br>   server.csr<br>   server.key</p>
</li>
</ul>
<p>注意/etc/asterisk/openvpn_attribute.conf文件的存在。</p>
<h4 id="客户端证书生成位置"><a href="#客户端证书生成位置" class="headerlink" title="客户端证书生成位置"></a>客户端证书生成位置</h4><ul>
<li><p>/www/openvpnkeys/</p>
<p>   Phone1.tar<br>   client.tar</p>
</li>
</ul>
<h3 id="PPP"><a href="#PPP" class="headerlink" title="PPP"></a>PPP</h3><p>支持ppp的用户信息和ppp配置选项存放位置</p>
<ul>
<li>/etc/ppp/</li>
</ul>
<p>主要文件如下</p>
<pre><code>chap-secrets   （用户）
options.pptpd   （pptpd）
options.xl2tpd    （xl2tpd）
pap-secrets    （用户）
</code></pre><h3 id="http-目录"><a href="#http-目录" class="headerlink" title="http 目录"></a>http 目录</h3><ul>
<li>/www</li>
</ul>
<h3 id="tftpd-存放目录"><a href="#tftpd-存放目录" class="headerlink" title="tftpd 存放目录"></a>tftpd 存放目录</h3><ul>
<li>/srv/tftpboot</li>
</ul>
<h3 id="inetd-文件"><a href="#inetd-文件" class="headerlink" title="inetd 文件"></a>inetd 文件</h3><ul>
<li>/etc/inetd     </li>
</ul>
<h3 id="Log"><a href="#Log" class="headerlink" title="Log"></a>Log</h3><p>日志目录(web登录、ssh登录等), Ssh登录日志通过last得来的。</p>
<ul>
<li>/var/log/messages //系统日志</li>
<li>存放于/www/log  和/www/syslogs</li>
</ul>
<h3 id="下载的链接创建"><a href="#下载的链接创建" class="headerlink" title="下载的链接创建"></a>下载的链接创建</h3><pre><code>ln -sf /var/lib/asterisk/prompts  /www/prompts                ;链接IVR提示音
ln -sf /etc/asterisk/keys  /www/keys                              ;链接SIP协议TLS注册证书。
ln -sf /var/spool/asterisk/monitor  /www/monitor                  ;链接通话录音文件
ln -sf /var/log/asterisk/cdr-custom  /www/cdr-csv              ;链接通话日志文件
ln -sf /var/spool/asterisk/voicemail/default  /www/voicemail
</code></pre><h2 id="程序包"><a href="#程序包" class="headerlink" title="程序包"></a>程序包</h2><pre><code>程序名    版本        说明
Asterisk    1.8.7.1        
Busybox    1.17.4        采用了httpd、inetd、tftpd、
IPtables    1.4.10        
Dropbear    v0.49        
Openssl    1.0.0d        
Libpri    1.4.12        
Openvpn    2.2.0        Easy-rsa程序包
Pppd    2.4.4        
Pptpd    1.3.4        
Rp-pppoe    3.10        
Spandsp    0.0.5        
Speex    1.2rc1        
Srtp    1.4.2        
Ssmtp    2.62        
Ntp    4.2.6p3        
Tiff    3.9.4        
Mailx    12.4        
Wget    1.12        
Xl2tp    1.2.7        
Netsnmp    5.6.1        
Ddns (updatedd)    2.6_        DDNS,源用了plannet
inadyn            DDNS
Upload    2.6        Web界面上传文件二进制程序
</code></pre><h3 id="etc-asterisk"><a href="#etc-asterisk" class="headerlink" title="/etc/asterisk"></a>/etc/asterisk</h3><p>说明：调整目录结构，主要将变化的数据都存放于/etc/asterisk目录下。<br>该目录有两种情况：第一种情况是/etc/asterisk与系统分区用一个分区；第二种情况/etc/asterisk/单独存放与一个分区中。其主要目的为双机热备和磁盘恢复准备。</p>

        </section>
    </article>
    
        
  </div>
  <aside>
    
    <div class="toc-container">
        <h1>目录</h1>
        <div class="content">
            <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Coovox-2016-10-4"><span class="toc-number">1.</span> <span class="toc-text">Coovox 2016/10/4</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#目录结构"><span class="toc-number">1.1.</span> <span class="toc-text">目录结构</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#语音文件位置"><span class="toc-number">1.1.1.</span> <span class="toc-text">语音文件位置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#录音文件"><span class="toc-number">1.1.2.</span> <span class="toc-text">录音文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#prompts"><span class="toc-number">1.1.3.</span> <span class="toc-text">prompts</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Music"><span class="toc-number">1.1.4.</span> <span class="toc-text">Music</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Voicemail"><span class="toc-number">1.1.5.</span> <span class="toc-text">Voicemail</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Fax"><span class="toc-number">1.1.6.</span> <span class="toc-text">Fax</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Call-Log"><span class="toc-number">1.1.7.</span> <span class="toc-text">Call Log</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#脚本程序"><span class="toc-number">1.1.8.</span> <span class="toc-text">脚本程序</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#IP"><span class="toc-number">1.1.9.</span> <span class="toc-text">IP</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#cgi"><span class="toc-number">1.1.10.</span> <span class="toc-text">cgi</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#PPTP-VPN"><span class="toc-number">1.1.11.</span> <span class="toc-text">PPTP VPN</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#证书位置"><span class="toc-number">1.1.12.</span> <span class="toc-text">证书位置</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#TLS的证书位置"><span class="toc-number">1.1.12.1.</span> <span class="toc-text">TLS的证书位置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#openvpn-证书位置"><span class="toc-number">1.1.12.2.</span> <span class="toc-text">openvpn 证书位置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#客户端证书生成位置"><span class="toc-number">1.1.12.3.</span> <span class="toc-text">客户端证书生成位置</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#PPP"><span class="toc-number">1.1.13.</span> <span class="toc-text">PPP</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#http-目录"><span class="toc-number">1.1.14.</span> <span class="toc-text">http 目录</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#tftpd-存放目录"><span class="toc-number">1.1.15.</span> <span class="toc-text">tftpd 存放目录</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#inetd-文件"><span class="toc-number">1.1.16.</span> <span class="toc-text">inetd 文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Log"><span class="toc-number">1.1.17.</span> <span class="toc-text">Log</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#下载的链接创建"><span class="toc-number">1.1.18.</span> <span class="toc-text">下载的链接创建</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#程序包"><span class="toc-number">1.2.</span> <span class="toc-text">程序包</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#etc-asterisk"><span class="toc-number">1.2.1.</span> <span class="toc-text">/etc/asterisk</span></a></li></ol></li></ol></li></ol>
        </div>
    </div>
    
  </aside>
</main>



  <footer>
  <div class="copyright">
    <div>
      &copy; 2020 | Powered by <a href="https://hexo.io" target="_blank">Hexo</a>&nbsp
    </div>
    <div>
      Theme by <a href="https://github.com/tqcenglish/hexo-theme-clean" target="_blank">clean</a>
    </div>
  </div>
</footer>


<script src="https://cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script>
<script src="/lib/in-view.min.js"></script>
<script src="/lib/lodash.min.js"></script>
<script>
  var isDown = true
  var oldY = 0
  inView.offset(50)

  document.body.addEventListener('touchstart', function(){});
  
  window.addEventListener('scroll', _.throttle(e => {
    var currentY = window.scrollY
    if((oldY - currentY) < 0) {
      isDown = true
    } else {
      isDown = false
    }
    oldY = currentY
  }, 250))

  $("article img").each(function() {
      var strA = "<a data-fancybox='gallery' href='" + this.src + "'></a>";
      $(this).wrapAll(strA);
  });

  $('.toc-link').each(function() {
      var href = $(this).attr("href");
      
      inView(href).on('exit', () => {
        if (isDown) {
          handleActive(href)
        }
      })

      inView(href).on('enter', () => {
        if (!isDown) {
          handleActive(href)
        }
      })

      this.onclick = function(e) {
        var pos = $(href).offset().top - 10;
        $("html,body").animate({scrollTop: pos}, 300);
        setTimeout(() => {
          handleActive(href)
        }, 350)
        return false
      }
  })

  function handleActive(href) {
    document.querySelectorAll('.toc-link').forEach(elm => {
      elm.classList.remove('active')
    })
    document.querySelector(".toc [href='"+ href +"']").classList.add('active')
  }
</script>
<script src="/lib/jquery.fancybox.min.js"></script>


</body>
</html>
